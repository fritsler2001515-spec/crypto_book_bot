# Crypto Bot Backend

–ë—ç–∫–µ–Ω–¥ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–±–æ—Ç–∞ —Å —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ domain/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—á–∏—Å—Ç–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ entities/             # –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ use_cases/            # –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ repositories/         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îú‚îÄ‚îÄ infrastructure/            # –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ database/             # SQLAlchemy –º–æ–¥–µ–ª–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot/         # Telegram Bot API
‚îÇ   ‚îî‚îÄ‚îÄ external_apis/        # –í–Ω–µ—à–Ω–∏–µ API (CoinGecko)
‚îú‚îÄ‚îÄ presentation/              # UI —Å–ª–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ telegram_handlers/    # Telegram handlers
‚îÇ   ‚îî‚îÄ‚îÄ web_api/             # FastAPI endpoints
‚îî‚îÄ‚îÄ shared/                   # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ types/                # Pydantic —Å—Ö–µ–º—ã
    ‚îú‚îÄ‚îÄ config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ states.py             # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
    ‚îî‚îÄ‚îÄ keyboards.py          # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

#### –¢–∞–±–ª–∏—Ü–∞ `users`
- `id` (Integer, Primary Key) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `telegram_id` (BigInteger, Unique) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- `balance` (Numeric) - –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –¢–∞–±–ª–∏—Ü–∞ `user_portfolio`
- `id` (Integer, Primary Key) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- `user_id` (Integer, Foreign Key) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `symbol` (Text) - —Å–∏–º–≤–æ–ª –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, BTC)
- `name` (Text) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Bitcoin)
- `total_quantity` (Numeric) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç
- `avg_price` (Numeric) - —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏
- `current_price` (Numeric) - —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
- `total_spent` (Numeric) - –æ–±—â–∞—è —Å—É–º–º–∞ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è –Ω–∞ –ø–æ–∫—É–ø–∫—É
- `last_updated` (TIMESTAMP) - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –¢–∞–±–ª–∏—Ü–∞ `coin_transactions`
- `id` (Integer, Primary Key) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `user_id` (Integer, Foreign Key) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `symbol` (Text) - —Å–∏–º–≤–æ–ª –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
- `name` (Text) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
- `quantity` (Numeric) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `price` (Numeric) - —Ü–µ–Ω–∞ –∑–∞ –º–æ–Ω–µ—Ç—É
- `total_spent` (Numeric) - –æ–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `timestamp` (TIMESTAMP) - –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m .venv .venv
source .venv/bin/activate  # Linux/Mac
# –∏–ª–∏
.venv\Scripts\activate  # Windows
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
BOT_TOKEN=your_telegram_bot_token
DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=postgres
DB_USER=postgres
DB_PASS=user123
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
python scripts/init_db.py
```

## –ó–∞–ø—É—Å–∫

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
python main.py
```

### –ü—Ä–æ–¥–∞–∫—à–Ω
```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

## API Endpoints

### –ü–æ—Ä—Ç—Ñ–µ–ª—å
- `GET /api/portfolio/{telegram_id}` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/portfolio/add-coin` - –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—É –≤ –ø–æ—Ä—Ç—Ñ–µ–ª—å

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `GET /api/transactions/{telegram_id}` - –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /api/user/{telegram_id}` - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

## Telegram Bot

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `üíº –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç` - –ü–æ–∫–∞–∑–∞—Ç—å –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- `üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å` - –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å
- `‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—É` - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–æ–Ω–µ—Ç—É

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
pytest tests/
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### Domain Layer
- **Entities**: –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (User, Portfolio, Transaction)
- **Use Cases**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è)
- **Repositories**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

### Infrastructure Layer
- **Database**: SQLAlchemy –º–æ–¥–µ–ª–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- **External APIs**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CoinGecko API

### Presentation Layer
- **Telegram Handlers**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram —Å–æ–æ–±—â–µ–Ω–∏–π
- **Web API**: FastAPI endpoints –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### Shared
- **Types**: Pydantic —Å—Ö–µ–º—ã –¥–ª—è API
- **Config**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **States**: FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è Telegram –±–æ—Ç–∞
- **Keyboards**: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã 